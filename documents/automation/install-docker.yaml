schemaVersion: "1.2"
description: "Installs Docker if it's not already installed"
parameters:
  user:
    type: "String"
    description: "User to add to the docker group"
mainSteps:
  - name: "checkDocker"
    action: "aws:runShellScript"
    inputs:
      runCommand:
        - "docker --version"
    outputs:
      - name: "dockerInstalled"
        selector: "$?.ExitCode == 0"
        type: "Boolean"
  - name: "installDocker"
    action: "aws:runShellScript"
    condition: "!checkDocker.dockerInstalled"
    inputs:
      runCommand:
        - "sudo apt-get update -y"
        - "sudo apt-get install -y docker.io"
        - "sudo usermod -aG docker {{ user }}"