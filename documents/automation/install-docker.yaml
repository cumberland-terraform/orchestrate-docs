schemaVersion: "0.3"
description: "Installs Docker if it's not already installed"
parameters:
  user:
    type: "String"
    description: "User to add to the docker group"
mainSteps:
  - name: "checkDocker"
    action: "aws:runShellScript"
    inputs:
      runCommand:
        - "docker --version"
    outputs:
      - Name: dockerInstalled
        Selector: "$.stdout" # Capture the entire stdout
        Type: String
    nextStep: installDocker

  - name: "installDocker"
    action: "aws:runShellScript"
    condition: "'{{ checkDocker.dockerInstalled }}' == ''" # Condition on the full stdout
    inputs:
      runCommand:
        - "sudo apt-get update -y"
        - "sudo apt-get install -y docker.io"
        - "sudo usermod -aG docker {{ user }}"