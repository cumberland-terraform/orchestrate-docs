schemaVersion: "0.3"
description: "Installs Docker if it's not already installed"
parameters:
  user:
    type: "String"
    description: "User to add to the docker group"
mainSteps:
  - name: "checkDocker"
    action: "aws:runShellScript"
    inputs:
      runCommand:
        - "docker --version"
    outputs:
      - Name: dockerInstalled
        ResultSelector: "$.stdout.splitlines()[0]"  # Extract the version string
        Type: String
    nextStep: installDocker # Use nextStep for conditional logic

  - name: "installDocker"
    action: "aws:runShellScript"
    condition: "'{{ checkDocker.dockerInstalled }}' == ''" # Check if dockerInstalled is empty
    inputs:
      runCommand:
        - "sudo apt-get update -y"
        - "sudo apt-get install -y docker.io"
        - "sudo usermod -aG docker {{ user }}"